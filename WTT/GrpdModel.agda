{-# OPTIONS --rewriting --postfix-projections #-}

open import Utils
open import Utils.Macro
open import Common.Sort
open import Common.SortEq

module WTT.GrpdModel where 

module _ where
  open UtilVars

  uip : âˆ€ {p q : x â‰¡ y} â†’ p â‰¡ q
  uip {p = refl} {q = refl} = refl

  apdâ‚‚â€²-K : âˆ€ (B : A â†’ Set â„“â‚) {C : A â†’ Set â„“â‚‚} {y : B xâ‚}
              (f : âˆ€ x â†’ B x â†’ C x) (eqâ‚ : xâ‚ â‰¡ xâ‚‚) 
              {eqâ‚‚ : C xâ‚ â‰¡ C xâ‚‚} {eqâ‚ƒ : B xâ‚ â‰¡ B xâ‚‚} 
        â†’ f xâ‚ y â‰¡[ eqâ‚‚ ]â‰¡ f xâ‚‚ (coe eqâ‚ƒ y)
  apdâ‚‚â€²-K B f refl {refl} {refl} = refl 

open import WTT.Syntax

module Grpd where
  record Sorts : Setâ‚ where no-eta-equality; field
    Car : Set
    Rel : Car â†’ Car â†’ Set
  module _ (ğ’® : Sorts) where
    open Sorts ğ’®
    module Vars where variable
      x y z xâ‚ xâ‚‚ xâ‚ƒ : Car 
      xâ‚â‚‚ xâ‚‚â‚ƒ xâ‚â‚ƒ xâ‚ƒâ‚„ xâ‚‚â‚ xâ‚ƒâ‚‚ xâ‚â‚‚â€² : Rel xâ‚ xâ‚‚
    open Vars
    record Data : Set where 
      no-eta-equality
      field
        id  : Rel x x
        _â»Â¹ : Rel x y â†’ Rel y x
        _âˆ˜_ : Rel x y â†’ Rel y z â†’ Rel x z
        
        -- Equations 
        idâˆ˜ : id âˆ˜ xâ‚â‚‚ â‰¡ xâ‚â‚‚
        âˆ˜id : xâ‚â‚‚ âˆ˜ id â‰¡ xâ‚â‚‚
        âˆ˜âˆ˜  : (xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ) âˆ˜ xâ‚ƒâ‚„ â‰¡ xâ‚â‚‚ âˆ˜ (xâ‚‚â‚ƒ âˆ˜ xâ‚ƒâ‚„)
        âˆ˜â»Â¹ : xâ‚â‚‚ âˆ˜ (xâ‚â‚‚ â»Â¹) â‰¡ id
        â»Â¹âˆ˜ : (xâ‚â‚‚ â»Â¹) âˆ˜ xâ‚â‚‚ â‰¡ id

      idâ»Â¹ : id {x = x} â»Â¹ â‰¡ id
      idâ»Â¹ = 
        id â»Â¹
        â‰¡âŸ¨ sym idâˆ˜ âŸ©
        id âˆ˜ (id â»Â¹)
        â‰¡âŸ¨ âˆ˜â»Â¹ âŸ©
        id âˆ

      idâ»Â¹âˆ˜ : (id â»Â¹) âˆ˜ xâ‚â‚‚ â‰¡ xâ‚â‚‚
      idâ»Â¹âˆ˜ {xâ‚â‚‚ = xâ‚â‚‚} =
        âŒœ id â»Â¹ âŒ âˆ˜ xâ‚â‚‚
        â‰¡âŸ¨ ap! idâ»Â¹ âŸ©
        id âˆ˜ xâ‚â‚‚
        â‰¡âŸ¨ idâˆ˜ âŸ©
        xâ‚â‚‚ âˆ

      âˆ˜âˆ˜â»Â¹ : xâ‚â‚‚ âˆ˜ (xâ‚‚â‚ƒ âˆ˜ (xâ‚‚â‚ƒ â»Â¹)) â‰¡ xâ‚â‚‚
      âˆ˜âˆ˜â»Â¹ {xâ‚â‚‚ = xâ‚â‚‚} {xâ‚‚â‚ƒ = xâ‚‚â‚ƒ} =
        xâ‚â‚‚ âˆ˜ âŒœ xâ‚‚â‚ƒ âˆ˜ (xâ‚‚â‚ƒ â»Â¹) âŒ 
        â‰¡âŸ¨ ap! âˆ˜â»Â¹ âŸ©
        xâ‚â‚‚ âˆ˜ id
        â‰¡âŸ¨ âˆ˜id âŸ©
        xâ‚â‚‚ âˆ

      âˆ˜â»Â¹âˆ˜ : xâ‚â‚‚ âˆ˜ ((xâ‚ƒâ‚‚ â»Â¹) âˆ˜ xâ‚ƒâ‚‚) â‰¡ xâ‚â‚‚
      âˆ˜â»Â¹âˆ˜ {xâ‚â‚‚ = xâ‚â‚‚} {xâ‚ƒâ‚‚ = xâ‚ƒâ‚‚} =
        xâ‚â‚‚ âˆ˜ âŒœ (xâ‚ƒâ‚‚ â»Â¹) âˆ˜ xâ‚ƒâ‚‚ âŒ 
        â‰¡âŸ¨ ap! â»Â¹âˆ˜ âŸ©
        xâ‚â‚‚ âˆ˜ id
        â‰¡âŸ¨ âˆ˜id âŸ©
        xâ‚â‚‚ âˆ

      â»Â¹âˆ˜âˆ˜ : ((xâ‚â‚‚ â»Â¹) âˆ˜ xâ‚â‚‚) âˆ˜ xâ‚‚â‚ƒ â‰¡ xâ‚‚â‚ƒ 
      â»Â¹âˆ˜âˆ˜ {xâ‚â‚‚ = xâ‚â‚‚} {xâ‚‚â‚ƒ = xâ‚‚â‚ƒ} =
        âŒœ (xâ‚â‚‚ â»Â¹) âˆ˜ xâ‚â‚‚ âŒ âˆ˜ xâ‚‚â‚ƒ
        â‰¡âŸ¨ ap! â»Â¹âˆ˜ âŸ©
        id âˆ˜ xâ‚‚â‚ƒ
        â‰¡âŸ¨ idâˆ˜ âŸ©
        xâ‚‚â‚ƒ âˆ

      â»Â¹âˆ˜idâˆ˜ : ((xâ‚â‚‚ â»Â¹) âˆ˜ id) âˆ˜ xâ‚â‚‚ â‰¡ id
      â»Â¹âˆ˜idâˆ˜ {xâ‚â‚‚ = xâ‚â‚‚} = 
        âŒœ (xâ‚â‚‚ â»Â¹) âˆ˜ id âŒ âˆ˜ xâ‚â‚‚
        â‰¡âŸ¨ ap! âˆ˜id âŸ©
        (xâ‚â‚‚ â»Â¹) âˆ˜ xâ‚â‚‚
        â‰¡âŸ¨ â»Â¹âˆ˜ âŸ©
        id âˆ

      idâˆ˜id : id âˆ˜ xâ‚â‚‚ â‰¡ xâ‚â‚‚ âˆ˜ id
      idâˆ˜id = idâˆ˜ âˆ™ sym âˆ˜id

      â»Â¹â»Â¹  : xâ‚â‚‚ â»Â¹ â»Â¹ â‰¡ xâ‚â‚‚
      â»Â¹â»Â¹ {xâ‚â‚‚ = xâ‚â‚‚} = 
        xâ‚â‚‚ â»Â¹ â»Â¹
        â‰¡âŸ¨ sym âˆ˜â»Â¹âˆ˜ âŸ©
        (xâ‚â‚‚ â»Â¹ â»Â¹) âˆ˜ ((xâ‚â‚‚ â»Â¹) âˆ˜ xâ‚â‚‚)
        â‰¡âŸ¨ sym âˆ˜âˆ˜ âŸ©
        ((xâ‚â‚‚ â»Â¹ â»Â¹) âˆ˜ (xâ‚â‚‚ â»Â¹)) âˆ˜ xâ‚â‚‚
        â‰¡âŸ¨ â»Â¹âˆ˜âˆ˜ âŸ©
        xâ‚â‚‚ âˆ

      âŸ¨âˆ˜âŸ©â»Â¹ : (xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ) â»Â¹ â‰¡ (xâ‚‚â‚ƒ â»Â¹) âˆ˜ (xâ‚â‚‚ â»Â¹)
      âŸ¨âˆ˜âŸ©â»Â¹ {xâ‚â‚‚ = xâ‚â‚‚} {xâ‚‚â‚ƒ = xâ‚‚â‚ƒ} = 
        (xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ) â»Â¹
        â‰¡âŸ¨ sym âˆ˜âˆ˜â»Â¹ âŸ©
        ((xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ) â»Â¹) âˆ˜ (âŒœ xâ‚â‚‚ âŒ âˆ˜ (xâ‚â‚‚ â»Â¹))
        â‰¡âŸ¨ ap! (sym âˆ˜âˆ˜â»Â¹) âŸ©
        ((xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ) â»Â¹) âˆ˜ (âŒœ xâ‚â‚‚ âˆ˜ (xâ‚‚â‚ƒ âˆ˜ (xâ‚‚â‚ƒ â»Â¹)) âŒ âˆ˜ (xâ‚â‚‚ â»Â¹))
        â‰¡âŸ¨ ap! (sym âˆ˜âˆ˜) âŸ©
        ((xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ) â»Â¹) âˆ˜ âŒœ ((xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ) âˆ˜ (xâ‚‚â‚ƒ â»Â¹)) âˆ˜ (xâ‚â‚‚ â»Â¹) âŒ
        â‰¡âŸ¨ ap! âˆ˜âˆ˜ âŸ©
        ((xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ) â»Â¹) âˆ˜ ((xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ) âˆ˜ ((xâ‚‚â‚ƒ â»Â¹) âˆ˜ (xâ‚â‚‚ â»Â¹)))
        â‰¡âŸ¨ sym âˆ˜âˆ˜ âŸ©
        (((xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ) â»Â¹) âˆ˜ (xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ)) âˆ˜ ((xâ‚‚â‚ƒ â»Â¹) âˆ˜ (xâ‚â‚‚ â»Â¹))
        â‰¡âŸ¨ â»Â¹âˆ˜âˆ˜ âŸ©
        (xâ‚‚â‚ƒ â»Â¹) âˆ˜ (xâ‚â‚‚ â»Â¹) âˆ

  open Sorts public
  open Data  public

Grpd : Setâ‚
Grpd = Î£ Grpd.Sorts Grpd.Data

-- Fibrant displayed groupoids
-- Equivalent to functors from |G| to |Grpd|
module Grpdá´° (G : Grpd) where
  open Grpd.Sorts (G .fst)
  open Grpd.Vars  (G .fst) 
  open Grpd.Data  (G .snd)
  record Sorts : Setâ‚ where no-eta-equality; field
    Cará´° : Car â†’ Set
    Relá´° : Cará´° xâ‚ â†’ Cará´° xâ‚‚ â†’ Rel xâ‚ xâ‚‚ â†’ Set
  module _ (ğ’® : Sorts) where
    open Sorts ğ’®
    module Vars where variable
      xá´° yá´° zá´° xâ‚á´° xâ‚‚á´° xâ‚ƒá´° xá´°â€² : Cará´° x
      xâ‚â‚‚á´° xâ‚‚â‚ƒá´° xâ‚ƒâ‚„á´° xá´°~ : Relá´° xâ‚á´° xâ‚‚á´° xâ‚â‚‚
    open Vars
    record Data : Set where 
      no-eta-equality
      field
        idá´°  : Relá´° xá´° xá´° id
        _â»Â¹á´° : Relá´° xâ‚á´° xâ‚‚á´° xâ‚â‚‚ â†’ Relá´° xâ‚‚á´° xâ‚á´° (xâ‚â‚‚ â»Â¹)
        _âˆ˜á´°_ : Relá´° xâ‚á´° xâ‚‚á´° xâ‚â‚‚ â†’ Relá´° xâ‚‚á´° xâ‚ƒá´° xâ‚‚â‚ƒ â†’ Relá´° xâ‚á´° xâ‚ƒá´° (xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ)
        
        -- Equations
        -- idâˆ˜ : id âˆ˜ xâ‚â‚‚ â‰¡ xâ‚â‚‚
        idâˆ˜á´°  : idá´° âˆ˜á´° xâ‚â‚‚á´° â‰¡[ ap (Relá´° _ _) idâˆ˜ ]â‰¡ xâ‚â‚‚á´°
        âˆ˜idá´° : xâ‚â‚‚á´° âˆ˜á´° idá´° â‰¡[ ap (Relá´° _ _) âˆ˜id ]â‰¡ xâ‚â‚‚á´°
        âˆ˜âˆ˜á´°  : (xâ‚â‚‚á´° âˆ˜á´° xâ‚‚â‚ƒá´°) âˆ˜á´° xâ‚ƒâ‚„á´° â‰¡[ ap (Relá´° _ _) âˆ˜âˆ˜ ]â‰¡ xâ‚â‚‚á´° âˆ˜á´° (xâ‚‚â‚ƒá´° âˆ˜á´° xâ‚ƒâ‚„á´°)
        âˆ˜â»Â¹á´° : xâ‚â‚‚á´° âˆ˜á´° (xâ‚â‚‚á´° â»Â¹á´°) â‰¡[ ap (Relá´° _ _) âˆ˜â»Â¹ ]â‰¡ idá´°
        â»Â¹âˆ˜á´° : (xâ‚â‚‚á´° â»Â¹á´°) âˆ˜á´° xâ‚â‚‚á´° â‰¡[ ap (Relá´° _ _) â»Â¹âˆ˜ ]â‰¡ idá´°

        -- Fibrancy
        coeG   : Rel xâ‚ xâ‚‚ â†’ Cará´° xâ‚ â†’ Cará´° xâ‚‚
        cohG   : Relá´° xá´° (coeG xâ‚â‚‚ xá´°) xâ‚â‚‚
        coe-id : coeG id xá´° â‰¡ xá´°
        coe-âˆ˜  : coeG (xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ) xá´° â‰¡ coeG xâ‚‚â‚ƒ (coeG xâ‚â‚‚ xá´°)
        coh-id : cohG â‰¡[ ap (Î» â–¡ â†’ Relá´° xá´° â–¡ id) coe-id ]â‰¡ idá´°
        coh-âˆ˜  : cohG â‰¡[ ap (Î» â–¡ â†’ Relá´° xá´° â–¡ (xâ‚â‚‚ âˆ˜ xâ‚‚â‚ƒ)) coe-âˆ˜ ]â‰¡ cohG âˆ˜á´° cohG

      â»Â¹â»Â¹á´° : xâ‚â‚‚á´° â»Â¹á´° â»Â¹á´° â‰¡[ ap (Relá´° _ _) â»Â¹â»Â¹ ]â‰¡ xâ‚â‚‚á´°
      â»Â¹â»Â¹á´° = {!!}

      idâ»Â¹âˆ˜á´° : (idá´° â»Â¹á´°) âˆ˜á´° xâ‚â‚‚á´° â‰¡[ ap (Relá´° _ _) idâ»Â¹âˆ˜ ]â‰¡ xâ‚â‚‚á´°
      idâ»Â¹âˆ˜á´° = {!!}

      coeGâ»Â¹  : Rel xâ‚ xâ‚‚ â†’ Cará´° xâ‚‚ â†’ Cará´° xâ‚
      coeGâ»Â¹ xâ‚â‚‚ = coeG (xâ‚â‚‚ â»Â¹)
      cohGâ»Â¹ : Relá´° (coeGâ»Â¹ xâ‚‚â‚ xá´°) xá´° xâ‚‚â‚
      cohGâ»Â¹ {xâ‚‚â‚ = xâ‚‚â‚} = transp (Relá´° _ _) â»Â¹â»Â¹ (cohG {xâ‚â‚‚ = xâ‚‚â‚ â»Â¹} â»Â¹á´°)
      coeG~ : Relá´° xá´° xá´°â€² id â†’ Relá´° (coeG xâ‚â‚‚ xá´°) (coeG xâ‚â‚‚ xá´°â€²) id
      coeG~ xá´°~ 
        = transp (Relá´° _ _) â»Â¹âˆ˜idâˆ˜ (((cohG â»Â¹á´°) âˆ˜á´° xá´°~) âˆ˜á´° cohG)

      -- Wow this is miserable...
      -- I think we need a better approach for lemmas like this.
      -- The transport shuffling when applying congruence to dependent equations
      -- is ridiculously fiddly, and ultimately pointless because we are relying
      -- on K anyway.
      -- 
      -- We could use heterogeneous equality, but I don't like the ergonomics
      -- (e.g. lack of type inference).
      -- Abstracting over the identity proofs to apply |J| or indexed pattern
      -- matching is lovely when it works, but it sometimes just doesn't, or
      -- finding the right stuff to abstract just takes too long.
      --
      -- Another approach could be to have a bunch of very generic utilities
      -- for working with equality that rely on |K|. E.g. see |apdâ‚‚â€²-K|.
      -- Figuring out what these utilities should look like is quite painful
      -- but when you do figure it out, it is quite nice.
      --
      -- Alternatively: I think "smart with" would be SUPER useful here!!
      cohG~ :  xá´°~ âˆ˜á´° cohG {xâ‚â‚‚ = xâ‚â‚‚}
            â‰¡[ ap (Relá´° _ _) idâˆ˜id
            ]â‰¡ cohG âˆ˜á´° coeG~ xá´°~
      cohG~ {xá´°~ = xá´°~} {xâ‚â‚‚ = xâ‚â‚‚} = 
        transp (Relá´° _ _) _ (xá´°~ âˆ˜á´° cohG)
        â‰¡âŸ¨ sym (extTransp idâˆ˜ idâˆ˜á´°) âŸ©
        transp (Relá´° _ _) _ (idá´° âˆ˜á´° (xá´°~ âˆ˜á´° cohG))
        â‰¡âŸ¨ sym (extTransp (ap (_âˆ˜ (id âˆ˜ xâ‚â‚‚)) âˆ˜â»Â¹) 
                          (ap[] (Relá´° _ _) (Î» â–¡ â†’ _âˆ˜á´° (xá´°~ âˆ˜á´° cohG)) âˆ˜â»Â¹á´°)) âŸ©
        transp (Relá´° _ _) _ ((cohG âˆ˜á´° (cohG â»Â¹á´°)) âˆ˜á´° (xá´°~ âˆ˜á´° cohG))
        â‰¡âŸ¨ sym (extTransp (sym âˆ˜âˆ˜) (sym[] âˆ˜âˆ˜á´°)) âŸ©
        transp (Relá´° _ _) _ (cohG âˆ˜á´° ((cohG â»Â¹á´°) âˆ˜á´° (xá´°~ âˆ˜á´° cohG)))
        â‰¡âŸ¨ sym (extTransp (ap (xâ‚â‚‚ âˆ˜_) âˆ˜âˆ˜) 
                          (ap[] (Relá´° _ _) (Î» _ â†’ cohG âˆ˜á´°_) âˆ˜âˆ˜á´°)) âŸ©
        transp (Relá´° _ _) _ (cohG âˆ˜á´° (((cohG â»Â¹á´°) âˆ˜á´° xá´°~) âˆ˜á´° cohG))
        â‰¡âŸ¨ apdâ‚‚â€²-K (Relá´° _ _) (Î» _ â–¡ â†’ cohG âˆ˜á´° â–¡) â»Â¹âˆ˜idâˆ˜ âŸ©
        cohG âˆ˜á´° transp (Relá´° _ _) _ (((cohG â»Â¹á´°) âˆ˜á´° xá´°~) âˆ˜á´° cohG)
        â‰¡âŸ¨âŸ©
        cohG âˆ˜á´° coeG~ xá´°~ âˆ
        
      cohG~â»Â¹ :  (cohGâ»Â¹ {xâ‚‚â‚ = xâ‚‚â‚} âˆ˜á´° xá´°~) 
              â‰¡[ ap (Relá´° _ _) (sym idâˆ˜id) 
              ]â‰¡ coeG~ xá´°~ âˆ˜á´° cohGâ»Â¹
      cohG~â»Â¹ = {!!}
  open Sorts public
  open Data  public


Grpdá´° : Grpd â†’ Setâ‚
Grpdá´° ğ’¢ = Î£ (Grpdá´°.Sorts ğ’¢) (Grpdá´°.Data ğ’¢)

open Grpd.Sorts
open Grpd.Data

open Grpdá´°.Sorts
open Grpdá´°.Data

-- Groupoid homomorphisms 
module _ (ğ’¢â‚ : Grpd) (ğ’¢â‚‚ : Grpd) (let (ğ’®â‚ , ğ’Ÿâ‚) = ğ’¢â‚) (let (ğ’®â‚‚ , ğ’Ÿâ‚‚) = ğ’¢â‚‚) where
  open Grpd.Vars ğ’®â‚
  record _â‡’_ : Set where no-eta-equality; field
    act  : ğ’®â‚ .Car â†’ ğ’®â‚‚ .Car
    pres : ğ’®â‚ .Rel x y â†’ ğ’®â‚‚ .Rel (act x) (act y)
    id   : pres (ğ’Ÿâ‚ .id {x = x}) â‰¡ ğ’Ÿâ‚‚ .id
    _â»Â¹  : pres (ğ’Ÿâ‚ ._â»Â¹ xâ‚â‚‚) â‰¡ ğ’Ÿâ‚‚ ._â»Â¹ (pres xâ‚â‚‚)
    _âˆ˜_  : pres (ğ’Ÿâ‚ ._âˆ˜_ xâ‚â‚‚ xâ‚‚â‚ƒ) â‰¡ ğ’Ÿâ‚‚ ._âˆ˜_ (pres xâ‚â‚‚) (pres xâ‚‚â‚ƒ)
open _â‡’_

-- Displayed groupoid homomorphisms
module _ (ğ’¢ : Grpd) (ğ’¢á´° : Grpdá´° ğ’¢) (let (ğ’® , ğ’Ÿ) = ğ’¢) (let (ğ’®á´° , ğ’Ÿá´°) = ğ’¢á´°) where
  open Grpd.Vars ğ’®
  record _â‡’á´°_ : Set where no-eta-equality; field
    act  : âˆ€ (x : ğ’® .Car) â†’ ğ’®á´° .Cará´° x
    pres : âˆ€ (xâ‚â‚‚ : ğ’® .Rel xâ‚ xâ‚‚) â†’ ğ’®á´° .Relá´° (act xâ‚) (act xâ‚‚) xâ‚â‚‚
    id   : pres (ğ’Ÿ .id {x = x}) â‰¡ ğ’Ÿá´° .idá´°
    _â»Â¹  : pres (ğ’Ÿ ._â»Â¹ xâ‚â‚‚) â‰¡ ğ’Ÿá´° ._â»Â¹á´° (pres xâ‚â‚‚)
    _âˆ˜_  : pres (ğ’Ÿ ._âˆ˜_ xâ‚â‚‚ xâ‚‚â‚ƒ) â‰¡ ğ’Ÿá´° ._âˆ˜á´°_ (pres xâ‚â‚‚) (pres xâ‚‚â‚ƒ)
open _â‡’á´°_

âŸ¦CtxâŸ§ : Setâ‚
âŸ¦CtxâŸ§ = Grpd

âŸ¦TyâŸ§ : âŸ¦CtxâŸ§ â†’ Setâ‚
âŸ¦TyâŸ§ âŸ¦Î“âŸ§ = Grpdá´° âŸ¦Î“âŸ§

âŸ¦SubâŸ§ : âŸ¦CtxâŸ§ â†’ âŸ¦CtxâŸ§ â†’ Set
âŸ¦SubâŸ§ âŸ¦Î”âŸ§ âŸ¦Î“âŸ§ = âŸ¦Î”âŸ§ â‡’ âŸ¦Î“âŸ§

âŸ¦TmâŸ§ : âˆ€ âŸ¦Î“âŸ§ â†’ âŸ¦TyâŸ§ âŸ¦Î“âŸ§ â†’ Set
âŸ¦TmâŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ = âŸ¦Î“âŸ§ â‡’á´° âŸ¦AâŸ§

variable
  âŸ¦Î“âŸ§ âŸ¦Î”âŸ§ âŸ¦Î˜âŸ§ âŸ¦Î“â‚âŸ§ âŸ¦Î“â‚‚âŸ§ âŸ¦Î”â‚âŸ§ âŸ¦Î”â‚‚âŸ§             
    : âŸ¦CtxâŸ§
  âŸ¦AâŸ§ âŸ¦BâŸ§ âŸ¦Aâ‚âŸ§ âŸ¦Aâ‚‚âŸ§ âŸ¦Bâ‚âŸ§ âŸ¦Bâ‚‚âŸ§ âŸ¦A[]âŸ§ âŸ¦B[]âŸ§ 
    : âŸ¦TyâŸ§ âŸ¦Î“âŸ§ 
  âŸ¦iâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ âŸ¦tâ‚âŸ§ âŸ¦tâ‚‚âŸ§ âŸ¦uâ‚âŸ§ âŸ¦uâ‚‚âŸ§ âŸ¦vâ‚âŸ§ âŸ¦vâ‚‚âŸ§ 
    âŸ¦i[]âŸ§ âŸ¦i[][]âŸ§ âŸ¦t[]âŸ§ âŸ¦u[]âŸ§ 
    : âŸ¦TmâŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§
  âŸ¦Î´âŸ§ âŸ¦ÏƒâŸ§ âŸ¦Î´â‚âŸ§ âŸ¦Î´â‚‚âŸ§                       
    : âŸ¦SubâŸ§ âŸ¦Î”âŸ§ âŸ¦Î“âŸ§
  Aâ‰¡ Aâ‰¡â‚ Aâ‰¡â‚‚ Aâ‰¡â‚ƒ Aâ‰¡â‚„ Bâ‰¡ Bâ‰¡â‚ Bâ‰¡â‚‚ Bâ‰¡â‚ƒ Bâ‰¡â‚„                             
    : âŸ¦Aâ‚âŸ§ â‰¡ âŸ¦Aâ‚‚âŸ§

Tyâ‰¡ = ap âŸ¦TyâŸ§

âŸ¦[]TâŸ§ : âŸ¦TyâŸ§ âŸ¦Î“âŸ§ â†’ âŸ¦SubâŸ§ âŸ¦Î”âŸ§ âŸ¦Î“âŸ§ â†’ âŸ¦TyâŸ§ âŸ¦Î”âŸ§
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .fst .Cará´° Ï 
  = âŸ¦AâŸ§ .fst .Cará´° (âŸ¦Î´âŸ§ .act Ï)
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .fst .Relá´° Ï„â‚ Ï„â‚‚ Ï„â‚â‚‚ 
  = âŸ¦AâŸ§ .fst .Relá´° Ï„â‚ Ï„â‚‚ (âŸ¦Î´âŸ§ .pres Ï„â‚â‚‚) 
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd .idá´°   
  = transp (Relá´° (âŸ¦AâŸ§ .fst) _ _) (sym (âŸ¦Î´âŸ§ .id)) (âŸ¦AâŸ§ .snd .idá´°)
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd ._â»Â¹á´° Ï„â‚â‚‚
  = transp (Relá´° (âŸ¦AâŸ§ .fst) _ _) (sym (âŸ¦Î´âŸ§ ._â»Â¹)) (âŸ¦AâŸ§ .snd ._â»Â¹á´° Ï„â‚â‚‚) 
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd ._âˆ˜á´°_ Ï„â‚â‚‚ Ï„â‚‚â‚ƒ
  = transp (Relá´° (âŸ¦AâŸ§ .fst) _ _) (sym (âŸ¦Î´âŸ§ ._âˆ˜_)) (âŸ¦AâŸ§ .snd ._âˆ˜á´°_ Ï„â‚â‚‚ Ï„â‚‚â‚ƒ)
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd .idâˆ˜á´° = {!   !}
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd .âˆ˜idá´° = {!   !}
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd .âˆ˜âˆ˜á´° = {!   !}
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd .âˆ˜â»Â¹á´° = {!   !}
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd .â»Â¹âˆ˜á´° = {!   !}
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd .coeG xâ‚â‚‚ xá´°   
  = âŸ¦AâŸ§ .snd .coeG (âŸ¦Î´âŸ§ .pres xâ‚â‚‚) xá´°
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd .cohG = âŸ¦AâŸ§ .snd .cohG
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd .coe-id 
  = transp (Î» â–¡ â†’ âŸ¦AâŸ§ .snd .coeG â–¡ _ â‰¡ _) (sym (âŸ¦Î´âŸ§ .id)) (âŸ¦AâŸ§ .snd .coe-id)
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd .coe-âˆ˜  = {!   !}
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd .coh-id = {!   !} 
âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§ .snd .coh-âˆ˜ = {!!}

âŸ¦[]âŸ§ : âŸ¦TmâŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ â†’ âˆ€ (âŸ¦Î´âŸ§ : âŸ¦SubâŸ§ âŸ¦Î”âŸ§ âŸ¦Î“âŸ§) 
     â†’ âŸ¦TmâŸ§ âŸ¦Î”âŸ§ (âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§)
âŸ¦[]âŸ§ âŸ¦tâŸ§ âŸ¦Î´âŸ§ .act  Ï   = âŸ¦tâŸ§ .act (âŸ¦Î´âŸ§ .act Ï)
âŸ¦[]âŸ§ âŸ¦tâŸ§ âŸ¦Î´âŸ§ .pres Ïâ‚â‚‚ = âŸ¦tâŸ§ .pres (âŸ¦Î´âŸ§ .pres Ïâ‚â‚‚)
âŸ¦[]âŸ§ {âŸ¦AâŸ§ = âŸ¦AâŸ§} {âŸ¦Î”âŸ§ = âŸ¦Î”âŸ§} âŸ¦tâŸ§ âŸ¦Î´âŸ§ .id =
  âŸ¦tâŸ§ .pres (âŸ¦Î´âŸ§ .pres _)
  â‰¡âŸ¨ sym (apd (âŸ¦tâŸ§ .pres) (sym (âŸ¦Î´âŸ§ .id)))  âŸ©
  transp (Relá´° (âŸ¦AâŸ§ .fst) _ _) (sym (âŸ¦Î´âŸ§ .id)) âŒœ âŸ¦tâŸ§ .pres _ âŒ 
  â‰¡âŸ¨ ap! (âŸ¦tâŸ§ .id) âŸ©
  transp (Relá´° (âŸ¦AâŸ§ .fst) _ _) (sym (âŸ¦Î´âŸ§ .id)) (âŸ¦AâŸ§ .snd .idá´°) âˆ
âŸ¦[]âŸ§ âŸ¦tâŸ§ âŸ¦Î´âŸ§ ._â»Â¹  = {!   !}
âŸ¦[]âŸ§ âŸ¦tâŸ§ âŸ¦Î´âŸ§ ._âˆ˜_  = {!   !}

âŸ¦â–·âŸ§ : âˆ€ âŸ¦Î“âŸ§ â†’ âŸ¦TyâŸ§ âŸ¦Î“âŸ§ â†’ âŸ¦CtxâŸ§
âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ .fst .Car = Î£ (âŸ¦Î“âŸ§ .fst .Car) (âŸ¦AâŸ§ .fst .Cará´°)
âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ .fst .Rel (Ïâ‚ , Ï„â‚) (Ïâ‚‚ , Ï„â‚‚) 
  = Î£ (âŸ¦Î“âŸ§ .fst .Rel Ïâ‚ Ïâ‚‚) (âŸ¦AâŸ§ .fst .Relá´° Ï„â‚ Ï„â‚‚)
âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ .snd .id  = âŸ¦Î“âŸ§ .snd .id , âŸ¦AâŸ§ .snd .idá´°
âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ .snd ._â»Â¹ (Ïâ‚â‚‚ , Ï„â‚â‚‚) 
  = âŸ¦Î“âŸ§ .snd ._â»Â¹ Ïâ‚â‚‚ , âŸ¦AâŸ§ .snd ._â»Â¹á´° Ï„â‚â‚‚
âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ .snd ._âˆ˜_ (Ïâ‚â‚‚ , Ï„â‚â‚‚) (Ïâ‚‚â‚ƒ , Ï„â‚‚â‚ƒ)
  = âŸ¦Î“âŸ§ .snd ._âˆ˜_ Ïâ‚â‚‚ Ïâ‚‚â‚ƒ , âŸ¦AâŸ§ .snd ._âˆ˜á´°_ Ï„â‚â‚‚ Ï„â‚‚â‚ƒ
âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ .snd .idâˆ˜
  = apdâ‚‚ _,_ (âŸ¦Î“âŸ§ .snd .idâˆ˜) (âŸ¦AâŸ§ .snd .idâˆ˜á´°)
âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ .snd .âˆ˜id 
  = apdâ‚‚ _,_ (âŸ¦Î“âŸ§ .snd .âˆ˜id) (âŸ¦AâŸ§ .snd .âˆ˜idá´°)
âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ .snd .âˆ˜âˆ˜  
  = apdâ‚‚ _,_ (âŸ¦Î“âŸ§ .snd .âˆ˜âˆ˜) (âŸ¦AâŸ§ .snd .âˆ˜âˆ˜á´°)
âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ .snd .âˆ˜â»Â¹
  = apdâ‚‚ _,_ (âŸ¦Î“âŸ§ .snd .âˆ˜â»Â¹) (âŸ¦AâŸ§ .snd .âˆ˜â»Â¹á´°)
âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ .snd .â»Â¹âˆ˜
  = apdâ‚‚ _,_ (âŸ¦Î“âŸ§ .snd .â»Â¹âˆ˜) (âŸ¦AâŸ§ .snd .â»Â¹âˆ˜á´°)

-- Weakening
âŸ¦wkâŸ§ : âŸ¦SubâŸ§ (âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§) âŸ¦Î“âŸ§
âŸ¦wkâŸ§ .act  (Ï , Ï„)     = Ï
âŸ¦wkâŸ§ .pres (Ïâ‚â‚‚ , Ï„â‚â‚‚) = Ïâ‚â‚‚
âŸ¦wkâŸ§ .id  = refl
âŸ¦wkâŸ§ ._â»Â¹ = refl
âŸ¦wkâŸ§ ._âˆ˜_ = refl

-- Substitution
âŸ¦<>âŸ§ : âŸ¦TmâŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ â†’ âŸ¦SubâŸ§ âŸ¦Î“âŸ§ (âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§)

-- Pi types
âŸ¦Î âŸ§ : âˆ€ âŸ¦AâŸ§ â†’ âŸ¦TyâŸ§ (âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§) â†’ âŸ¦TyâŸ§ âŸ¦Î“âŸ§
âŸ¦Î âŸ§ {âŸ¦Î“âŸ§ = âŸ¦Î“âŸ§} âŸ¦AâŸ§ âŸ¦BâŸ§ .fst .Cará´° Ï
  =  Î£ ((Ï… : âŸ¦AâŸ§ .fst .Cará´° Ï) â†’ âŸ¦BâŸ§ .fst .Cará´° (Ï , Ï…))
     -- Naturality, or something
     Î» f â†’ âˆ€ {Ï…â‚ Ï…â‚‚} (Ï…â‚â‚‚ : âŸ¦AâŸ§ .fst .Relá´° Ï…â‚ Ï…â‚‚ (âŸ¦Î“âŸ§ .snd .id)) 
         â†’ âŸ¦BâŸ§ .snd .coeG (âŸ¦Î“âŸ§ .snd .id , Ï…â‚â‚‚) (f Ï…â‚) â‰¡ f Ï…â‚‚
âŸ¦Î âŸ§ {âŸ¦Î“âŸ§ = âŸ¦Î“âŸ§} âŸ¦AâŸ§ âŸ¦BâŸ§ .fst .Relá´° {xâ‚ = Ïâ‚} {xâ‚‚ = Ïâ‚‚} Ï„â‚ Ï„â‚‚ Ïâ‚â‚‚ 
  = âˆ€ {Ï…â‚} {Ï…â‚‚} (Ï…â‚â‚‚ : âŸ¦AâŸ§ .fst .Relá´° Ï…â‚ Ï…â‚‚ Ïâ‚â‚‚)
  â†’ Relá´° (âŸ¦BâŸ§ .fst) (Ï„â‚ .fst Ï…â‚) (Ï„â‚‚ .fst Ï…â‚‚) (Ïâ‚â‚‚ , Ï…â‚â‚‚)
âŸ¦Î âŸ§ âŸ¦AâŸ§ âŸ¦BâŸ§ .snd .idá´° {xá´° = Ï„ , Ï„â‰¡} {Ï…â‚ = Ï…â‚} {Ï…â‚‚ = Ï…â‚‚} Ï…â‚â‚‚
  = transp (Î» â–¡ â†’ Relá´° (âŸ¦BâŸ§ .fst) (Ï„ Ï…â‚) â–¡ _) (Ï„â‰¡ Ï…â‚â‚‚) (âŸ¦BâŸ§ .snd .cohG)
âŸ¦Î âŸ§ {âŸ¦Î“âŸ§ = âŸ¦Î“âŸ§} âŸ¦AâŸ§ âŸ¦BâŸ§ .snd ._â»Â¹á´° Ï„â‚â‚‚ {Ï…â‚ = Ï…â‚} {Ï…â‚‚ = Ï…â‚‚} Ï…â‚â‚‚
  using Ï…â‚‚â‚ â† transp (âŸ¦AâŸ§ .fst .Relá´° _ _) (â»Â¹â»Â¹ (âŸ¦Î“âŸ§ .snd)) (âŸ¦AâŸ§ .snd ._â»Â¹á´° Ï…â‚â‚‚)
  = transp (âŸ¦BâŸ§ .fst .Relá´° _ _) (ap (_ ,_) 
  (âŸ¦AâŸ§ .snd ._â»Â¹á´° Ï…â‚‚â‚
  -- â‰¡âŸ¨ sym (apdâ‚‚â€² (Relá´° (âŸ¦AâŸ§ .fst) _ _) (Î» _ â†’ âŸ¦AâŸ§ .snd ._â»Â¹á´°) 
  --               (â»Â¹â»Â¹ (âŸ¦Î“âŸ§ .snd))) âŸ©
  -- transp (Î» â–¡ â†’ Relá´° (âŸ¦AâŸ§ .fst) Ï…â‚ Ï…â‚‚ (âŸ¦Î“âŸ§ .snd ._â»Â¹ â–¡)) (â»Â¹â»Â¹ (âŸ¦Î“âŸ§ .snd))
  --        (âŸ¦AâŸ§ .snd ._â»Â¹á´° (âŸ¦AâŸ§ .snd ._â»Â¹á´° Ï…â‚â‚‚))
  -- â‰¡âŸ¨âŸ©
  -- coe âŒœ _ âŒ (âŸ¦AâŸ§ .snd ._â»Â¹á´° (âŸ¦AâŸ§ .snd ._â»Â¹á´° Ï…â‚â‚‚))
  -- â‰¡âŸ¨ ap! uip âŸ© 
  â‰¡âŸ¨ sym (apdâ‚‚â€²-K (Relá´° (âŸ¦AâŸ§ .fst) Ï…â‚‚ Ï…â‚) (Î» _ â†’ âŸ¦AâŸ§ .snd ._â»Â¹á´°)  
         (â»Â¹â»Â¹ (âŸ¦Î“âŸ§ .snd))) âŸ© 
  transp (âŸ¦AâŸ§ .fst .Relá´° _ _) (â»Â¹â»Â¹ (âŸ¦Î“âŸ§ .snd)) 
         (âŸ¦AâŸ§ .snd ._â»Â¹á´° (âŸ¦AâŸ§ .snd ._â»Â¹á´° Ï…â‚â‚‚))
  â‰¡âŸ¨ â»Â¹â»Â¹á´° (âŸ¦AâŸ§ .snd) âŸ©
  Ï…â‚â‚‚ âˆ)) (âŸ¦BâŸ§ .snd ._â»Â¹á´° (Ï„â‚â‚‚ Ï…â‚‚â‚))

âŸ¦Î âŸ§ âŸ¦AâŸ§ âŸ¦BâŸ§ .snd ._âˆ˜á´°_   = {!   !}
âŸ¦Î âŸ§ âŸ¦AâŸ§ âŸ¦BâŸ§ .snd .idâˆ˜á´°   = {!   !}
âŸ¦Î âŸ§ âŸ¦AâŸ§ âŸ¦BâŸ§ .snd .âˆ˜idá´°   = {!   !}
âŸ¦Î âŸ§ âŸ¦AâŸ§ âŸ¦BâŸ§ .snd .âˆ˜âˆ˜á´°    = {!   !}
âŸ¦Î âŸ§ âŸ¦AâŸ§ âŸ¦BâŸ§ .snd .âˆ˜â»Â¹á´°   = {!   !}
âŸ¦Î âŸ§ âŸ¦AâŸ§ âŸ¦BâŸ§ .snd .â»Â¹âˆ˜á´°   = {!   !}
âŸ¦Î âŸ§ {âŸ¦Î“âŸ§ = âŸ¦Î“âŸ§} âŸ¦AâŸ§ âŸ¦BâŸ§ .snd .coeG   Ïâ‚â‚‚ (Ï„ , Ï„â‰¡) .fst Ï…
  = âŸ¦BâŸ§ .snd .coeG (Ïâ‚â‚‚ , cohGâ»Â¹ (âŸ¦AâŸ§ .snd)) 
                   (Ï„ (âŸ¦AâŸ§ .snd .coeG (âŸ¦Î“âŸ§ .snd ._â»Â¹ Ïâ‚â‚‚) Ï…))
âŸ¦Î âŸ§ {âŸ¦Î“âŸ§ = âŸ¦Î“âŸ§} âŸ¦AâŸ§ âŸ¦BâŸ§ .snd .coeG   Ïâ‚â‚‚ (Ï„ , Ï„â‰¡) .snd {Ï…â‚ = Ï…â‚} {Ï…â‚‚ = Ï…â‚‚} Ï…â‚â‚‚ = 
  âŸ¦BâŸ§ .snd .coeG (_ , Ï…â‚â‚‚)
      (âŸ¦BâŸ§ .snd .coeG (Ïâ‚â‚‚ , cohGâ»Â¹ (âŸ¦AâŸ§ .snd))
         (Ï„ (âŸ¦AâŸ§ .snd .coeG _ Ï…â‚)))
  â‰¡âŸ¨ sym (âŸ¦BâŸ§ .snd .coe-âˆ˜) âŸ©
  âŸ¦BâŸ§ .snd .coeG âŒœ âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ .snd ._âˆ˜_ (Ïâ‚â‚‚ , cohGâ»Â¹ (âŸ¦AâŸ§ .snd)) (_ , Ï…â‚â‚‚) âŒ 
                 (Ï„ (coeGâ»Â¹ (âŸ¦AâŸ§ .snd) Ïâ‚â‚‚ Ï…â‚))
  â‰¡âŸ¨ ap! (apdâ‚‚ _,_ (sym (idâˆ˜id (âŸ¦Î“âŸ§ .snd))) (cohG~â»Â¹ (âŸ¦AâŸ§ .snd))) âŸ©
  âŸ¦BâŸ§ .snd .coeG (âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ .snd ._âˆ˜_ (_ , coeG~ (âŸ¦AâŸ§ .snd) Ï…â‚â‚‚) 
                                        (Ïâ‚â‚‚ , cohGâ»Â¹ (âŸ¦AâŸ§ .snd))) 
                 (Ï„ (coeGâ»Â¹ (âŸ¦AâŸ§ .snd) Ïâ‚â‚‚ Ï…â‚))
  â‰¡âŸ¨ âŸ¦BâŸ§ .snd .coe-âˆ˜ âŸ©
  âŸ¦BâŸ§ .snd .coeG (Ïâ‚â‚‚ , cohGâ»Â¹ (âŸ¦AâŸ§ .snd))
      âŒœ âŸ¦BâŸ§ .snd .coeG (_ , coeG~ (âŸ¦AâŸ§ .snd) Ï…â‚â‚‚)
                      (Ï„ (coeGâ»Â¹ (âŸ¦AâŸ§ .snd) Ïâ‚â‚‚ Ï…â‚)) âŒ
  â‰¡âŸ¨ ap! (Ï„â‰¡ {Ï…â‚ = coeGâ»Â¹ (âŸ¦AâŸ§ .snd) Ïâ‚â‚‚ Ï…â‚} {Ï…â‚‚ = coeGâ»Â¹ (âŸ¦AâŸ§ .snd) Ïâ‚â‚‚ Ï…â‚‚} 
             (coeG~ (âŸ¦AâŸ§ .snd) Ï…â‚â‚‚)) âŸ©
  âŸ¦BâŸ§ .snd .coeG (Ïâ‚â‚‚ , cohGâ»Â¹ (âŸ¦AâŸ§ .snd)) (Ï„ (coeGâ»Â¹ (âŸ¦AâŸ§ .snd) Ïâ‚â‚‚ Ï…â‚‚)) âˆ
âŸ¦Î âŸ§ âŸ¦AâŸ§ âŸ¦BâŸ§ .snd .cohG  {xá´° = Ï„ , Ï„â‰¡} Ï…â‚â‚‚ =
  {!!} 
  -- transp (âŸ¦BâŸ§ .fst .Relá´° _ _) _
  --        (âŸ¦BâŸ§ .snd ._âˆ˜á´°_ 
  --        (âŸ¦BâŸ§ .snd ._âˆ˜á´°_ (âŸ¦BâŸ§ .snd .cohG) (coeG~ (âŸ¦BâŸ§ .snd) 
  --           _))
  --                        _)
âŸ¦Î âŸ§ âŸ¦AâŸ§ âŸ¦BâŸ§ .snd .coe-id = {!   !}
âŸ¦Î âŸ§ âŸ¦AâŸ§ âŸ¦BâŸ§ .snd .coe-âˆ˜  = {!   !}
âŸ¦Î âŸ§ âŸ¦AâŸ§ âŸ¦BâŸ§ .snd .coh-id = {!   !}
âŸ¦Î âŸ§ âŸ¦AâŸ§ âŸ¦BâŸ§ .snd .coh-âˆ˜  = {!   !} 

-- Identity types
âŸ¦IdâŸ§ : (âŸ¦AâŸ§ : âŸ¦TyâŸ§ âŸ¦Î“âŸ§) â†’ âŸ¦TmâŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ â†’ âŸ¦TmâŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§ â†’ âŸ¦TyâŸ§ âŸ¦Î“âŸ§
âŸ¦IdâŸ§ {âŸ¦Î“âŸ§ = âŸ¦Î“âŸ§} âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .fst .Cará´° Ï 
  = Relá´° (âŸ¦AâŸ§ .fst) (âŸ¦tâŸ§ .act Ï) (âŸ¦uâŸ§ .act Ï) (id (âŸ¦Î“âŸ§ .snd))
âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .fst .Relá´° tuâ‚á´° tuâ‚‚á´° Ïâ‚â‚‚ 
  = âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .coeG Ïâ‚â‚‚ tuâ‚á´° â‰¡ tuâ‚‚á´°
âŸ¦IdâŸ§ {âŸ¦Î“âŸ§ = âŸ¦Î“âŸ§} âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .idá´° {xá´° = tuá´°}  = 
  âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .coeG _ tuá´°
  â‰¡âŸ¨ {!!} âŸ©
  tuá´° âˆ
âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd ._â»Â¹á´° = {!   !}
âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd ._âˆ˜á´°_ = {!   !}
âŸ¦IdâŸ§ {âŸ¦Î“âŸ§ = âŸ¦Î“âŸ§} âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .coeG   Ïâ‚â‚‚ tuá´°
  = transp (Relá´° (âŸ¦AâŸ§ .fst) _ _) 
           (ap (âŸ¦Î“âŸ§ .snd ._âˆ˜_ (âŸ¦Î“âŸ§ .snd ._â»Â¹ Ïâ‚â‚‚)) (âŸ¦Î“âŸ§ .snd . idâˆ˜) 
           âˆ™ â»Â¹âˆ˜ (âŸ¦Î“âŸ§ .snd)) 
    (âŸ¦AâŸ§ .snd ._âˆ˜á´°_ ((âŸ¦AâŸ§ .snd ._â»Â¹á´°) (âŸ¦tâŸ§ .pres Ïâ‚â‚‚))  
    (âŸ¦AâŸ§ .snd ._âˆ˜á´°_ tuá´° 
    (âŸ¦uâŸ§ .pres Ïâ‚â‚‚)))
âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .idâˆ˜á´° = {!   !}
âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .âˆ˜idá´° = {!   !}
âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .âˆ˜âˆ˜á´° = {!   !}
âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .âˆ˜â»Â¹á´° = {!   !}
âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .â»Â¹âˆ˜á´° = {!   !}
âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .cohG   = refl
âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .coe-id = {!   !}
âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .coe-âˆ˜  = {!   !}
âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .coh-id = {!   !}
âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§ .snd .coh-âˆ˜  = {!   !}

âŸ¦vzâŸ§ : âŸ¦TmâŸ§ (âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§) (âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦wkâŸ§)
âŸ¦vzâŸ§ .act  (Ï , Ï„)     = Ï„
âŸ¦vzâŸ§ .pres (Ïâ‚â‚‚ , Ï„â‚â‚‚) = Ï„â‚â‚‚
âŸ¦vzâŸ§ .id   = refl
âŸ¦vzâŸ§ ._â»Â¹  = refl
âŸ¦vzâŸ§ ._âˆ˜_  = refl

âŸ¦idâŸ§ : âŸ¦SubâŸ§ âŸ¦Î“âŸ§ âŸ¦Î“âŸ§
âŸ¦idâŸ§ .act  Ï   = Ï
âŸ¦idâŸ§ .pres Ïâ‚â‚‚ = Ïâ‚â‚‚
âŸ¦idâŸ§ .id       = refl
âŸ¦idâŸ§ ._â»Â¹      = refl
âŸ¦idâŸ§ ._âˆ˜_      = refl

âŸ¦,âŸ§ : (âŸ¦Î´âŸ§ : âŸ¦SubâŸ§ âŸ¦Î”âŸ§ âŸ¦Î“âŸ§) â†’ âŸ¦TmâŸ§ âŸ¦Î”âŸ§ (âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§)
    â†’ âŸ¦SubâŸ§ âŸ¦Î”âŸ§ (âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§) 
âŸ¦,âŸ§ âŸ¦Î´âŸ§ âŸ¦tâŸ§ .act  Ï = âŸ¦Î´âŸ§ .act Ï , âŸ¦tâŸ§ .act Ï
âŸ¦,âŸ§ âŸ¦Î´âŸ§ âŸ¦tâŸ§ .pres = {!   !}
âŸ¦,âŸ§ âŸ¦Î´âŸ§ âŸ¦tâŸ§ .id   = {!   !}
âŸ¦,âŸ§ âŸ¦Î´âŸ§ âŸ¦tâŸ§ â»Â¹    = {!   !}
âŸ¦,âŸ§ âŸ¦Î´âŸ§ âŸ¦tâŸ§ ._âˆ˜_  = {!   !}

âŸ¦reflâŸ§ : âŸ¦TmâŸ§ âŸ¦Î“âŸ§ (âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦tâŸ§)
âŸ¦reflâŸ§ {âŸ¦AâŸ§ = âŸ¦AâŸ§} .act Ï = âŸ¦AâŸ§ .snd .idá´°
âŸ¦reflâŸ§ .pres = {!   !}
âŸ¦reflâŸ§ .id  = {!   !}
âŸ¦reflâŸ§ ._â»Â¹ = {!   !}
âŸ¦reflâŸ§ ._âˆ˜_ = {!   !}

âŸ¦â¨¾âŸ§ : âŸ¦SubâŸ§ âŸ¦Î”âŸ§ âŸ¦Î“âŸ§ â†’ âŸ¦SubâŸ§ âŸ¦Î˜âŸ§ âŸ¦Î”âŸ§ â†’ âŸ¦SubâŸ§ âŸ¦Î˜âŸ§ âŸ¦Î“âŸ§

postulate
  âŸ¦[id]TâŸ§ : âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦idâŸ§ â‰¡ âŸ¦AâŸ§
  âŸ¦[][]TâŸ§ : âŸ¦[]TâŸ§ (âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§) âŸ¦ÏƒâŸ§ â‰¡ âŸ¦[]TâŸ§ âŸ¦AâŸ§ (âŸ¦â¨¾âŸ§ âŸ¦Î´âŸ§ âŸ¦ÏƒâŸ§) 
  âŸ¦Id[]TâŸ§ : âŸ¦[]TâŸ§ (âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§) âŸ¦Î´âŸ§ 
          â‰¡ âŸ¦IdâŸ§ (âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦Î´âŸ§) (âŸ¦[]âŸ§ âŸ¦tâŸ§ âŸ¦Î´âŸ§) (âŸ¦[]âŸ§ âŸ¦uâŸ§ âŸ¦Î´âŸ§)
  âŸ¦wk,âŸ§   : âŸ¦â¨¾âŸ§ âŸ¦wkâŸ§ (âŸ¦,âŸ§ âŸ¦Î´âŸ§ âŸ¦tâŸ§) â‰¡ âŸ¦Î´âŸ§
{-# REWRITE âŸ¦[id]TâŸ§ âŸ¦[][]TâŸ§ âŸ¦Id[]TâŸ§ âŸ¦wk,âŸ§ #-}

postulate
  âŸ¦[id]âŸ§ : âŸ¦[]âŸ§ âŸ¦tâŸ§ âŸ¦idâŸ§ â‰¡ âŸ¦tâŸ§
  âŸ¦[][]âŸ§ : âŸ¦[]âŸ§ (âŸ¦[]âŸ§ âŸ¦tâŸ§ âŸ¦Î´âŸ§) âŸ¦ÏƒâŸ§ â‰¡ âŸ¦[]âŸ§ âŸ¦tâŸ§ (âŸ¦â¨¾âŸ§ âŸ¦Î´âŸ§ âŸ¦ÏƒâŸ§) 
  âŸ¦vz,âŸ§  : âŸ¦[]âŸ§ âŸ¦vzâŸ§ (âŸ¦,âŸ§ âŸ¦Î´âŸ§ âŸ¦uâŸ§) â‰¡ âŸ¦uâŸ§
{-# REWRITE âŸ¦[id]âŸ§ âŸ¦[][]âŸ§ âŸ¦vz,âŸ§ #-}

âŸ¦JâŸ§ : (âŸ¦PâŸ§ : âŸ¦TyâŸ§ (âŸ¦â–·âŸ§ (âŸ¦â–·âŸ§ âŸ¦Î“âŸ§ âŸ¦AâŸ§) 
                       (âŸ¦IdâŸ§ (âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦wkâŸ§) (âŸ¦[]âŸ§ âŸ¦tâŸ§ âŸ¦wkâŸ§) âŸ¦vzâŸ§)))
    â†’ âŸ¦TmâŸ§ âŸ¦Î“âŸ§ (âŸ¦[]TâŸ§ âŸ¦PâŸ§ (âŸ¦,âŸ§ (âŸ¦,âŸ§ âŸ¦idâŸ§ âŸ¦tâŸ§) âŸ¦reflâŸ§))
    â†’ (âŸ¦pâŸ§ : âŸ¦TmâŸ§ âŸ¦Î“âŸ§ (âŸ¦IdâŸ§ âŸ¦AâŸ§ âŸ¦tâŸ§ âŸ¦uâŸ§))
    â†’ âŸ¦TmâŸ§ âŸ¦Î“âŸ§ (âŸ¦[]TâŸ§ âŸ¦PâŸ§ (âŸ¦,âŸ§ (âŸ¦,âŸ§ âŸ¦idâŸ§ âŸ¦uâŸ§) âŸ¦pâŸ§))
âŸ¦JâŸ§ {âŸ¦Î“âŸ§ = âŸ¦Î“âŸ§} {âŸ¦AâŸ§ = âŸ¦AâŸ§} {âŸ¦tâŸ§ = âŸ¦tâŸ§} {âŸ¦uâŸ§ = âŸ¦uâŸ§} âŸ¦PâŸ§ âŸ¦dâŸ§ âŸ¦pâŸ§ .act  Ï 
  = âŸ¦PâŸ§ .snd .coeG ((id (âŸ¦Î“âŸ§ .snd) , âŸ¦pâŸ§ .act Ï) , 
  -- Intuitively, here we are proving that âŸ¦reflâŸ§ and âŸ¦pâŸ§ are related over âŸ¦pâŸ§
  -- Explicitly, we construct
  -- âŸ¦IdâŸ§ (âŸ¦[]TâŸ§ âŸ¦AâŸ§ âŸ¦wkâŸ§) (âŸ¦[]âŸ§ âŸ¦tâŸ§ âŸ¦wkâŸ§) âŸ¦vzâŸ§ .fst .Relá´°
  --      (âŸ¦reflâŸ§ .act Ï) (âŸ¦pâŸ§ .act Ï) (âŸ¦Î“âŸ§ .snd .id , âŸ¦pâŸ§ .act Ï)
  (coe _ (âŸ¦AâŸ§ .snd ._âˆ˜á´°_ (âŸ¦AâŸ§ .snd ._â»Â¹á´° âŒœ(âŸ¦tâŸ§ .pres (id (âŸ¦Î“âŸ§ .snd)))âŒ)
         (âŸ¦AâŸ§ .snd ._âˆ˜á´°_ (âŸ¦AâŸ§ .snd .idá´°) (âŸ¦pâŸ§ .act Ï)))
  â‰¡âŸ¨ ap! (âŸ¦tâŸ§ .id) âŸ©
  coe âŒœ _ âŒ (âŸ¦AâŸ§ .snd ._âˆ˜á´°_ (âŸ¦AâŸ§ .snd ._â»Â¹á´° (âŸ¦AâŸ§ .snd .idá´°))
            (âŸ¦AâŸ§ .snd ._âˆ˜á´°_ (âŸ¦AâŸ§ .snd .idá´°) (âŸ¦pâŸ§ .act Ï)))
  â‰¡âŸ¨ ap! uip âŸ©
  coe _ (âŸ¦AâŸ§ .snd ._âˆ˜á´°_ (âŸ¦AâŸ§ .snd ._â»Â¹á´° (âŸ¦AâŸ§ .snd .idá´°))
        (âŸ¦AâŸ§ .snd ._âˆ˜á´°_ (âŸ¦AâŸ§ .snd .idá´°) (âŸ¦pâŸ§ .act Ï)))
  â‰¡âŸ¨ extTransp (idâ»Â¹âˆ˜ (âŸ¦Î“âŸ§ .snd)) (idâ»Â¹âˆ˜á´° (âŸ¦AâŸ§ .snd)) âŸ©
  coe _ (âŸ¦AâŸ§ .snd ._âˆ˜á´°_ (âŸ¦AâŸ§ .snd .idá´°) (âŸ¦pâŸ§ .act Ï))
  â‰¡âŸ¨ extTransp (âŸ¦Î“âŸ§ .snd .idâˆ˜) (âŸ¦AâŸ§ .snd .idâˆ˜á´°) âŸ©
  coe refl (âŸ¦pâŸ§ .act Ï)
  â‰¡âŸ¨âŸ©
  âŸ¦pâŸ§ .act Ï âˆ)) (âŸ¦dâŸ§ .act Ï)
âŸ¦JâŸ§ âŸ¦PâŸ§ âŸ¦dâŸ§ âŸ¦pâŸ§ .pres = {!   !}
âŸ¦JâŸ§ âŸ¦PâŸ§ âŸ¦dâŸ§ âŸ¦pâŸ§ .id   = {!   !}
âŸ¦JâŸ§ âŸ¦PâŸ§ âŸ¦dâŸ§ âŸ¦pâŸ§ ._â»Â¹  = {!   !}
âŸ¦JâŸ§ âŸ¦PâŸ§ âŸ¦dâŸ§ âŸ¦pâŸ§ ._âˆ˜_  = {!   !}
